<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>android test ui performance 测试UI性能 &#8211; wi's Tech Blog</title>
<meta name="description" content="notes, articles, or reproduced">
<meta name="keywords" content="testing, game, performance">



<!-- Open Graph -->
<meta property="og:locale" content="zh_CN">
<meta property="og:type" content="article">
<meta property="og:title" content="android test ui performance 测试UI性能">
<meta property="og:description" content="notes, articles, or reproduced">
<meta property="og:url" content="/dev/android/android-testing-ui-performance/">
<meta property="og:site_name" content="wi's Tech Blog">
<meta property="og:image" content="/images/images/avatar.png">





<link rel="canonical" href="/dev/android/android-testing-ui-performance/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="wi's Tech Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/jquery.mmenu.all.css">
<link rel="stylesheet" href="/assets/css/jquery.floating-social-share.min.css">
<!-- Webfonts -->

<meta http-equiv="cleartype" content="on">

<script type="text/javascript">window.jQuery || document.write('<script type="text/javascript" src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script type="text/javascript" src="/assets/js/scripts.min.js"></script>

<!-- table of content -->
<script type="text/javascript" src="/assets/js/vendor/toc.js"></script>


<!-- Load Modernizr -->
<script type="text/javascript" src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>


<!-- Mathjax Support -->
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">




</head>

<body>

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->



<div class="header-menu header-menu-top">
    <ul class="header-item-container">
      <li class="header-item-title header-toggle "><a href="#menu"><i class="fa fa-bars"></i></a></li>
      <li class="header-item-title">
        <a href="/">
          
            <img class="logo" src="/images/avatar.png" alt="wi's Tech Blog">
          
          <a href="/" class="title"> wi's Tech Blog</a>
        </a>
      </li>
      
        
        


        
            
                <li class="header-item "><a href="/favorites">fav</a></li>
            
        
      
        
        


        
            
                <li class="header-item "><a href="/categories">Categories</a></li>
            
        
      
        
        


        
            
                <li class="header-item "><a href="/tags">Tags</a></li>
            
        
      
        
        


        
            
                <li class="header-item "><a href="/">Home</a></li>
            
        
      
      <li class="header-item"><a href="/search"><i class="fa fa-search"></i></a></li>
    </ul>
  </div>



<nav id="menu" style="display: none">
  <ul>
    
      
        <li><a href="/"><h3>Home</h3></a></li>
      
    
      
        <li><a href="/tags"><h3>Tags</h3></a></li>
      
    
      
        <li><a href="/categories"><h3>Categories</h3></a>
          <ul>
            
              
                <li><a href="/categories/#UML">UML</a></li>
            
              
                <li><a href="/categories/#Windows">Windows</a></li>
            
              
                <li><a href="/categories/#adb">adb</a></li>
            
              
                <li><a href="/categories/#adt">adt</a></li>
            
              
                <li><a href="/categories/#android">android</a></li>
            
              
                <li><a href="/categories/#apache">apache</a></li>
            
              
                <li><a href="/categories/#apple">apple</a></li>
            
              
                <li><a href="/categories/#bat">bat</a></li>
            
              
                <li><a href="/categories/#blog">blog</a></li>
            
              
                <li><a href="/categories/#blog_sample">blog_sample</a></li>
            
              
                <li><a href="/categories/#browser">browser</a></li>
            
              
                <li><a href="/categories/#burpsuite">burpsuite</a></li>
            
              
                <li><a href="/categories/#centos">centos</a></li>
            
              
                <li><a href="/categories/#chrome">chrome</a></li>
            
              
                <li><a href="/categories/#cm">cm</a></li>
            
              
                <li><a href="/categories/#common">common</a></li>
            
              
                <li><a href="/categories/#css">css</a></li>
            
              
                <li><a href="/categories/#cygwin">cygwin</a></li>
            
              
                <li><a href="/categories/#database">database</a></li>
            
              
                <li><a href="/categories/#db">db</a></li>
            
              
                <li><a href="/categories/#dev">dev</a></li>
            
              
                <li><a href="/categories/#device">device</a></li>
            
              
                <li><a href="/categories/#diff">diff</a></li>
            
              
                <li><a href="/categories/#disk">disk</a></li>
            
              
                <li><a href="/categories/#diy">diy</a></li>
            
              
                <li><a href="/categories/#dns">dns</a></li>
            
              
                <li><a href="/categories/#doc">doc</a></li>
            
              
                <li><a href="/categories/#docker">docker</a></li>
            
              
                <li><a href="/categories/#efi">efi</a></li>
            
              
                <li><a href="/categories/#emacs">emacs</a></li>
            
              
                <li><a href="/categories/#email">email</a></li>
            
              
                <li><a href="/categories/#emulator">emulator</a></li>
            
              
                <li><a href="/categories/#english">english</a></li>
            
              
                <li><a href="/categories/#esxi">esxi</a></li>
            
              
                <li><a href="/categories/#excel">excel</a></li>
            
              
                <li><a href="/categories/#exsi">exsi</a></li>
            
              
                <li><a href="/categories/#favorites">favorites</a></li>
            
              
                <li><a href="/categories/#ftp">ftp</a></li>
            
              
                <li><a href="/categories/#game">game</a></li>
            
              
                <li><a href="/categories/#git">git</a></li>
            
              
                <li><a href="/categories/#gitlab">gitlab</a></li>
            
              
                <li><a href="/categories/#go">go</a></li>
            
              
                <li><a href="/categories/#golang">golang</a></li>
            
              
                <li><a href="/categories/#hardware">hardware</a></li>
            
              
                <li><a href="/categories/#ide">ide</a></li>
            
              
                <li><a href="/categories/#internet">internet</a></li>
            
              
                <li><a href="/categories/#java">java</a></li>
            
              
                <li><a href="/categories/#javascript">javascript</a></li>
            
              
                <li><a href="/categories/#jekyll">jekyll</a></li>
            
              
                <li><a href="/categories/#jenkins">jenkins</a></li>
            
              
                <li><a href="/categories/#jmeter">jmeter</a></li>
            
              
                <li><a href="/categories/#kate">kate</a></li>
            
              
                <li><a href="/categories/#kde">kde</a></li>
            
              
                <li><a href="/categories/#ldap">ldap</a></li>
            
              
                <li><a href="/categories/#learn">learn</a></li>
            
              
                <li><a href="/categories/#learning">learning</a></li>
            
              
                <li><a href="/categories/#links">links</a></li>
            
              
                <li><a href="/categories/#linux">linux</a></li>
            
              
                <li><a href="/categories/#living">living</a></li>
            
              
                <li><a href="/categories/#mac">mac</a></li>
            
              
                <li><a href="/categories/#mac-os">mac-os</a></li>
            
              
                <li><a href="/categories/#macos">macos</a></li>
            
              
                <li><a href="/categories/#mail">mail</a></li>
            
              
                <li><a href="/categories/#manjaro">manjaro</a></li>
            
              
                <li><a href="/categories/#markdown">markdown</a></li>
            
              
                <li><a href="/categories/#maven">maven</a></li>
            
              
                <li><a href="/categories/#memcached">memcached</a></li>
            
              
                <li><a href="/categories/#microsoft">microsoft</a></li>
            
              
                <li><a href="/categories/#moco">moco</a></li>
            
              
                <li><a href="/categories/#mysql">mysql</a></li>
            
              
                <li><a href="/categories/#nas">nas</a></li>
            
              
                <li><a href="/categories/#ndk">ndk</a></li>
            
              
                <li><a href="/categories/#netbean">netbean</a></li>
            
              
                <li><a href="/categories/#network">network</a></li>
            
              
                <li><a href="/categories/#netwrok">netwrok</a></li>
            
              
                <li><a href="/categories/#nginx">nginx</a></li>
            
              
                <li><a href="/categories/#nodejs">nodejs</a></li>
            
              
                <li><a href="/categories/#notepad++">notepad++</a></li>
            
              
                <li><a href="/categories/#office">office</a></li>
            
              
                <li><a href="/categories/#open-course">open-course</a></li>
            
              
                <li><a href="/categories/#openkm">openkm</a></li>
            
              
                <li><a href="/categories/#openwrt">openwrt</a></li>
            
              
                <li><a href="/categories/#outlook">outlook</a></li>
            
              
                <li><a href="/categories/#pdf">pdf</a></li>
            
              
                <li><a href="/categories/#perl">perl</a></li>
            
              
                <li><a href="/categories/#phone">phone</a></li>
            
              
                <li><a href="/categories/#php">php</a></li>
            
              
                <li><a href="/categories/#postgresql">postgresql</a></li>
            
              
                <li><a href="/categories/#product">product</a></li>
            
              
                <li><a href="/categories/#python">python</a></li>
            
              
                <li><a href="/categories/#rails">rails</a></li>
            
              
                <li><a href="/categories/#redmine">redmine</a></li>
            
              
                <li><a href="/categories/#regex">regex</a></li>
            
              
                <li><a href="/categories/#router">router</a></li>
            
              
                <li><a href="/categories/#ruby">ruby</a></li>
            
              
                <li><a href="/categories/#search-engine">search-engine</a></li>
            
              
                <li><a href="/categories/#security">security</a></li>
            
              
                <li><a href="/categories/#sed">sed</a></li>
            
              
                <li><a href="/categories/#ssh">ssh</a></li>
            
              
                <li><a href="/categories/#streaming">streaming</a></li>
            
              
                <li><a href="/categories/#study">study</a></li>
            
              
                <li><a href="/categories/#subversion">subversion</a></li>
            
              
                <li><a href="/categories/#tcpdump">tcpdump</a></li>
            
              
                <li><a href="/categories/#tech">tech</a></li>
            
              
                <li><a href="/categories/#testing">testing</a></li>
            
              
                <li><a href="/categories/#testlink">testlink</a></li>
            
              
                <li><a href="/categories/#text">text</a></li>
            
              
                <li><a href="/categories/#tomcat">tomcat</a></li>
            
              
                <li><a href="/categories/#ubuntu">ubuntu</a></li>
            
              
                <li><a href="/categories/#ufw">ufw</a></li>
            
              
                <li><a href="/categories/#vbs">vbs</a></li>
            
              
                <li><a href="/categories/#vim">vim</a></li>
            
              
                <li><a href="/categories/#virtual-box">virtual-box</a></li>
            
              
                <li><a href="/categories/#virtualbox">virtualbox</a></li>
            
              
                <li><a href="/categories/#virtualization">virtualization</a></li>
            
              
                <li><a href="/categories/#vm">vm</a></li>
            
              
                <li><a href="/categories/#vpn">vpn</a></li>
            
              
                <li><a href="/categories/#web">web</a></li>
            
              
                <li><a href="/categories/#windows">windows</a></li>
            
              
                <li><a href="/categories/#xampp">xampp</a></li>
            
              
                <li><a href="/categories/#收藏夹">收藏夹</a></li>
            
              
                <li><a href="/categories/#测试工具">测试工具</a></li>
            
              
                <li><a href="/categories/#玩机">玩机</a></li>
            
          </ul>
        </li>
      
    
      
        <li><a href="/favorites"><h3>fav</h3></a></li>
      
    
  </ul>
</nav>




<div id="post" >
<div id="main" role="main" >
  <article class="hentry">
    <div class="entry-content">
        
      <h1 class="post-title entry-title">android test ui performance 测试UI性能</h1>
      
        <h3><span class="entry-date date published updated"><time datetime="2018-02-23T00:00:00+08:00">February 23, 2018</time></span></h3>
      
      
      
      
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 60);
  return false
})

$(".toc-button").on('click', function(){
  $(".toc").toggle();
});


$(window).click(function(evt){
  if( !evt.target.matches('.toc') 
      && !evt.target.matches('.toc>ul') 
      && !evt.target.matches('.toc-button') ) {
    $('.toc').each(function(){
      if( $(this).is(":visible") ) {
        $(this).hide();
      }
    });
  }
});

});
</script>

<div class="float-toc">
    <i class="toc-button fa fa-list-ol" aria-hidden="true"></i>
  <div id="toc"></div>
</div>

      
      
      <ul>
  <li>来源： <a href="https://developer.android.com/training/testing/performance.html">https://developer.android.com/training/testing/performance.html</a></li>
</ul>

<h2 id="user-interface-ui-performance-testing">User interface (UI) performance testing</h2>

<p>测试app是否像黄油一样丝滑，保持 60fps，是否卡顿（without any dropped or delayed frames, or jank）</p>

<blockquote>
  <p>为啥要 60fsp？</p>
  <blockquote>
    <ul>
      <li><a href="https://www.zhihu.com/question/21081976">知乎 - 是不是游戏帧数一般要到 60 帧每秒才流畅</a></li>
      <li><a href="https://www.youtube.com/watch?v=CaMTIgxCSqU&amp;index=25&amp;list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE">油管视频，解释为啥要60fps</a></li>
    </ul>
  </blockquote>
</blockquote>

<h2 id="measuring-ui-performance">Measuring UI Performance</h2>

<p>如何度量UI性能？</p>

<p>使用 <a href="https://developer.android.com/studio/command-line/dumpsys.html">dumpsys</a> 打印出 performance 信息。This command can produce multiple different variants of frame timing data.</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>&gt; adb shell dumpsys gfxinfo &lt;PACKAGE_NAME&gt;
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="aggregate-frame-stats-聚合帧统计">Aggregate frame stats 聚合帧统计</h3>

<p>With Android 6.0 (API level 23) the command prints out aggregated analysis of frame data to logcat, collected across the entire lifetime of the process. For example:</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11</pre></td><td class="code"><pre>Stats since: 752958278148ns
Total frames rendered: 82189
Janky frames: 35335 (42.99%)
90th percentile: 34ms
95th percentile: 42ms
99th percentile: 69ms
Number Missed Vsync: 4706
Number High input latency: 142
Number Slow UI thread: 17270
Number Slow bitmap uploads: 1542
Number Slow draw: 23342
</pre></td></tr></tbody></table>
</div>
</div>

<p>These high level statistics convey at a high level the rendering performance of the app, as well as its stability across many frames.</p>

<h3 id="precise-frame-timing-info-具体的帧耗时信息">Precise frame timing info 具体的帧耗时信息</h3>

<p>With Android 6.0 comes a new command for <code class="highlighter-rouge">gfxinfo</code>, and that’s framestats which provides extremely detailed frame timing information from recent frames, so that you can track down and debug problems more accurately.</p>

<p><code class="highlighter-rouge">framestats</code> 是 Android 6.0 引入的<code class="highlighter-rouge">gfxinfo</code>新命令，帮助打印出当前帧的具体渲染时间信息，来帮助Debuug。</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>&gt;adb shell dumpsys gfxinfo &lt;PACKAGE_NAME&gt; framestats
</pre></td></tr></tbody></table>
</div>
</div>

<p>This command prints out frame timing information, with nanosecond（10亿纳秒 = 1秒） timestamps, from the last 120 frames produced by the app. Below is example raw output from <code class="highlighter-rouge">adb dumpsys gfxinfo &lt;PACKAGE_NAME&gt; framestats</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>Flags,IntendedVsync,Vsync,OldestInputEvent,NewestInputEvent,HandleInputStart,AnimationStart,PerformTraversalsStart,DrawStart,SyncQueued,SyncStart,IssueDrawCommandsStart,SwapBuffers,FrameCompleted,
0,27965466202353,27965466202353,27965449758000,27965461202353,27965467153286,27965471442505,27965471925682,27965474025318,27965474588547,27965474860786,27965475078599,27965479796151,27965480589068,
0,27965482993342,27965482993342,27965465835000,27965477993342,27965483807401,27965486875630,27965487288443,27965489520682,27965490184380,27965490568703,27965491408078,27965496119641,27965496619641,
0,27965499784331,27965499784331,27965481404000,27965494784331,27965500785318,27965503736099,27965504201151,27965506776568,27965507298443,27965507515005,27965508405474,27965513495318,27965514061984,
0,27965516575320,27965516575320,27965497155000,27965511575320,27965517697349,27965521276151,27965521734797,27965524350474,27965524884536,27965525160578,27965526020891,27965531371203,27965532114484,
</pre></td></tr></tbody></table>
</div>
</div>

<p>每行数据对应一帧。数据是CSV格式的，方便拷贝到excel中筛选、查看。<br />
出现的timestamp数据的单位，都是 nanosecond（纳秒）。</p>

<h4 id="flags">FLAGS</h4>

<p>这列数据为 0 才有效。</p>

<ul>
  <li>Rows with a ‘0’ for the FLAGS column can have their total frame time computed by subtracting the INTENDED_VSYNC column from the FRAME_COMPLETED column.</li>
  <li>If this is non-zero the row should be ignored, as the frame has been determined as being an outlier from normal performance, where it is expected that layout &amp; draw take longer than 16ms. Here are a few reasons this could occur:
    <ul>
      <li>The window layout changed (such as the first frame of the application or after a rotation)</li>
      <li>It is also possible the frame was skipped in which case some of the values will have garbage timestamps. A frame can be skipped if for example it is out-running 60fps or if nothing on-screen ended up being dirty, this is not necessarily a sign of a problem in the app.</li>
    </ul>
  </li>
</ul>

<h4 id="intended_vsync">INTENDED_VSYNC</h4>

<p>这列数据如果和后面一列 VSYNC 不一样，说明 UI 线程有其他计算，导致不能按预期时间进行渲染。</p>

<ul>
  <li>The intended start point for the frame. If this value is different from VSYNC, there was work occurring on the UI thread that prevented it from responding to the vsync signal in a timely fashion.</li>
</ul>

<h4 id="vsync">VSYNC</h4>

<ul>
  <li>The time value that was used in all the vsync listeners and drawing for the frame (Choreographer frame callbacks, animations, View.getDrawingTime(), etc…)</li>
  <li>To understand more about VSYNC and how it influences your application, check out the <a href="https://www.youtube.com/watch?v=1iaHxmfZGGc&amp;list=PLOU2XLYxmsIKEOXh5TwZEv89aofHzNCiu&amp;index=23">Understanding VSYNC</a> video.</li>
</ul>

<h4 id="oldest_input_event">OLDEST_INPUT_EVENT</h4>

<ul>
  <li>The timestamp of the oldest input event in the input queue, or Long.MAX_VALUE if there were no input events for the frame.</li>
  <li>This value is primarily intended for platform work and has limited usefulness to app developers.</li>
</ul>

<h4 id="newest_input_event">NEWEST_INPUT_EVENT</h4>

<ul>
  <li>The timestamp of the newest input event in the input queue, or 0 if there were no input events for the frame.</li>
  <li>This value is primarily intended for platform work and has limited usefulness to app developers.</li>
  <li>However it’s possible to get a rough idea of how much latency the app is adding by looking at (FRAME_COMPLETED - NEWEST_INPUT_EVENT).</li>
</ul>

<h4 id="handle_input_start">HANDLE_INPUT_START</h4>

<p><code class="highlighter-rouge">ANIMATION_START - HANDLE_INPUT_START</code> = app花在处理input event 上的时间</p>
<ul>
  <li>如果 大于2毫秒，说明耗时长了。一般是 <code class="highlighter-rouge">View.onTouchEvent()</code> 里面用时间长了。</li>
  <li>
    <p>某些情况，例如启动新Activity，长一点没关系。</p>
  </li>
  <li>The timestamp at which input events were dispatched to the application.</li>
  <li>By looking at the time between this and ANIMATION_START it is possible to measure how long the application spent handling input events.</li>
  <li>If this number is high (<code class="highlighter-rouge">&gt;2ms</code>), this indicates the app is spending an unusually long time processing input events, such as <code class="highlighter-rouge">View.onTouchEvent()</code>, which may indicate this work needs to be optimized, or offloaded to a different thread. Note that there are some scenarios, such as click events that launch new activities or similar, where it is expected and acceptable that this number is large.</li>
</ul>

<h4 id="animation_start">ANIMATION_START</h4>

<ul>
  <li>The timestamp at which animations registered with Choreographer were run.</li>
  <li>By looking at the time between this and PERFORM_TRANVERSALS_START it is possible to determine how long it took to evaluate all the animators (ObjectAnimator, ViewPropertyAnimator, and Transitions being the common ones) that are running.</li>
  <li>If this number is high (&gt;2ms), check to see if your app has written any custom animators or what fields ObjectAnimators are animating and ensure they are appropriate for an animation.<br />
To learn more about Choreographer, check out the <a href="https://www.youtube.com/watch?v=Q8m9sHdyXnE">For Butter or Worse video</a>.</li>
</ul>

<h4 id="perform_traversals_start">PERFORM_TRAVERSALS_START</h4>

<ul>
  <li>If you subtract out DRAW_START from this value, you can extract how long the layout &amp; measure phases took to complete. (note, during a scroll, or animation, you would hope this should be close to zero..)</li>
  <li>To learn more about the measure &amp; layout phases of the rendering pipeline, check out the <a href="https://www.youtube.com/watch?v=we6poP0kw6E&amp;list=PLOU2XLYxmsIKEOXh5TwZEv89aofHzNCiu&amp;index=27">Invalidations, Layouts and Performance</a> video</li>
</ul>

<h4 id="draw_start">DRAW_START</h4>

<ul>
  <li>The time at which the draw phase of performTraversals started. This is the start point of recording the display lists of any views that were invalidated.</li>
  <li>The time between this and SYNC_START is how long it took to call View.draw() on all the invalidated views in the tree.</li>
  <li>For more information on the drawing model, see <a href="https://developer.android.com/guide/topics/graphics/hardware-accel.html#hardware-model">Hardware Acceleration</a> or the <a href="https://www.youtube.com/watch?v=we6poP0kw6E&amp;list=PLOU2XLYxmsIKEOXh5TwZEv89aofHzNCiu&amp;index=27">Invalidations, Layouts and Performance</a> video</li>
</ul>

<h4 id="sync_queued">SYNC_QUEUED</h4>

<ul>
  <li>The time at which a sync request was sent to the RenderThread.</li>
  <li>This marks the point at which a message to start the sync phase was sent to the RenderThread. If the time between this and SYNC_START is substantial (&gt;0.1ms or so), it means that the RenderThread was busy working on a different frame. Internally this is used to differentiate between the frame doing too much work and exceeding the 16ms budget and the frame being stalled due to the previous frame exceeding the 16ms budget.</li>
</ul>

<h4 id="sync_start">SYNC_START</h4>

<ul>
  <li>The time at which the sync phase of the drawing started.</li>
  <li>If the time between this and ISSUE_DRAW_COMMANDS_START is substantial (&gt;0.4ms or so), it typically indicates a lot of new Bitmaps were drawn which must be uploaded to the GPU.<br />
To understand more about the sync phase, check out the <a href="https://www.youtube.com/watch?v=VzYkVL1n4M8&amp;index=24&amp;list=PLOU2XLYxmsIKEOXh5TwZEv89aofHzNCiu">Profile GPU Rendering video</a></li>
</ul>

<h4 id="issue_draw_commands_start">ISSUE_DRAW_COMMANDS_START</h4>

<ul>
  <li>The time at which the hardware renderer started issuing drawing commands to the GPU.</li>
  <li>The time between this and FRAME_COMPLETED gives a rough idea of how much GPU work the app is producing. Problems like too much overdraw or inefficient rendering effects show up here.</li>
</ul>

<h4 id="swap_buffers">SWAP_BUFFERS</h4>

<p>The time at which eglSwapBuffers was called, relatively uninteresting outside of platform work.</p>

<h4 id="frame_completed">FRAME_COMPLETED</h4>

<p>All done! The total time spent working on this frame can be computed by doing <code class="highlighter-rouge">FRAME_COMPLETED - INTENDED_VSYNC</code>.</p>

<h3 id="分析帧耗时数据">分析帧耗时数据</h3>

<p>You can use this data in different ways. One simple but useful visualization is a histogram showing the distribution of frames times (FRAME_COMPLETED - INTENDED_VSYNC) in different latency buckets, see figure below. This graph tells us at a glance that most frames were very good - well below the 16ms deadline (depicted in red), but a few frames were significantly over the deadline. We can look at changes in this histogram over time to see wholesale shifts or new outliers being created. You can also graph input latency, time spent in layout, or other similar interesting metrics based on the many timestamps in the data.</p>

<p><img src="perf-test-framestats.png" alt="" /></p>

<h3 id="simple-frame-timing-dump">Simple frame timing dump</h3>

<p>If <strong>Profile GPU rendering</strong> is set to In <code class="highlighter-rouge">adb shell dumpsys gfxinfo</code> in Developer Options, the adb shell dumpsys gfxinfo command prints out timing information for the most recent 120 frames, broken into a few different categories with tab-separated-values. This data can be useful for indicating which parts of the drawing pipeline may be slow at a high level.</p>

<p>Similar to framestats above, it’s very straightforward to paste it to your spreadsheet tool of choice, or collect and parse with a script. The following graph shows a breakdown of where many frames produced by the app were spending their time.</p>

<p><img src="perf-test-frame-latency.png" alt="" /></p>

<p>The result of running gfxinfo, copying the output, pasting it into a spreadsheet application, and graphing the data as stacked bars.</p>

<p>Each vertical bar represents one frame of animation; its height represents the number of milliseconds it took to compute that frame of animation. Each colored segment of the bar represents a different stage of the rendering pipeline, so that you can see what parts of your application may be creating a bottleneck. For more information on understanding the rendering pipeline, and how to optimize for it, see the Invalidations Layouts and Performance video</p>

<h3 id="controlling-the-window-of-stat-collection">Controlling the window of stat collection</h3>

<p>Both the framestats and simple frame timings gather data over a very short window - about two seconds worth of rendering. In order to precisely control this window of time - for example, to constrain the data to a particular animation - you can reset all counters, and aggregate statistics gathered.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>adb shell dumpsys gfxinfo &lt;PACKAGE_NAME&gt; reset
</pre></td></tr></tbody></table>
</div>
</div>

<p>This can also be used in conjunction with the dumping commands themselves to collect and reset at a regular cadence, capturing less-than-two-second windows of frames continuously.</p>

<h3 id="diagnosing-performance-regressions">Diagnosing performance regressions</h3>

<p>Identification of regressions is a good first step to tracking down problems, and maintaining high application health. However, <code class="highlighter-rouge">dumpsys</code> just identifies the existence and relative severity of problems. You still need to diagnose the particular cause of the performance problems, and find appropriate ways to fix them. For that, it’s highly recommended to use the [<code class="highlighter-rouge">systrace</code>] tool.</p>

<h3 id="additional-resources">Additional resources</h3>

<p>For more information on how Android’s rendering pipeline works, common problems that you can find there, and how to fix them, some of the following resources may be useful to you:</p>

<ul>
  <li><a href="https://www.youtube.com/watch?v=HXQhu6qfTVU">Rendering Performance 101</a></li>
  <li><a href="https://www.youtube.com/watch?v=CaMTIgxCSqU&amp;index=25&amp;list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE">Why 60fps?</a></li>
  <li><a href="https://www.youtube.com/watch?v=WH9AFhgwmDw">Android, UI, and the GPU</a></li>
  <li><a href="https://www.youtube.com/watch?v=we6poP0kw6E&amp;list=PLOU2XLYxmsIKEOXh5TwZEv89aofHzNCiu&amp;index=27">Invalidations, Layouts and Performance</a></li>
  <li><a href="https://developer.android.com/studio/profile/systrace.html">Analyzing UI Performance with Systrace</a></li>
</ul>

<h2 id="automating-ui-performance-tests">Automating UI Performance Tests</h2>

<p>One approach to UI Performance testing is to simply have a human tester perform a set of user operations on the target app, and either visually look for jank, or spend an very large amount of time using a tool-driven approach to find it. But this manual approach is fraught with peril - human ability to perceive frame rate changes varies tremendously, and this is also time consuming, tedious, and error prone.</p>

<p>A more efficient approach is to log and analyze key performance metrics from automated UI tests. Android 6.0 includes new logging capabilities which make it easy to determine the amount and severity of jank in your application’s animations, and that can be used to build a rigorous process to determine your current performance and track future performance objectives.</p>

<p>To learn more about performance tests on Android, see <a href="https://codelabs.developers.google.com/codelabs/android-perf-testing/index.html?index=..%2F..%2Findex#0">Automated Performance Testing Codelab</a>. In this codelab, you’ll learn how to write and execute automated tests and review the results to understand how to improve your app performance.</p>


      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags#testing" title="Pages tagged testing" class="tag"><span class="term">testing</span></a><a href="/tags#game" title="Pages tagged game" class="tag"><span class="term">game</span></a><a href="/tags#performance" title="Pages tagged performance" class="tag"><span class="term">performance</span></a></span>
        
        
      </footer>
    </div><!-- /.entry-content -->
    
    
    
  </article>
</div><!-- /#main -->
</div><!-- post container -->














<script type="text/javascript">
  // embeded-iframe
  $(window).load(function(){
    $('.embeded-iframe').each(function(){
      $(this).height($(this).contents().find('html').height());
    });
  });
</script>





<div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2023 wi. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://github.com/aron-bordin/neo-hpstr-jekyll-theme" rel="nofollow">Neo-HPSTR Theme</a>.</span>

<script src="/assets/js/main.js?20230725301728281823445"></script>

  </footer>
</div><!-- /.footer-wrapper -->

</body>
</html>
