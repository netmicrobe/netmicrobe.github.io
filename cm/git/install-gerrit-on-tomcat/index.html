<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Install Gerrit on Tomcat_Apache on Windows &#8211; wi's Tech Blog</title>
<meta name="description" content="notes, articles, or reproduced">
<meta name="keywords" content="cm, git, tomcat">



<!-- Open Graph -->
<meta property="og:locale" content="zh_CN">
<meta property="og:type" content="article">
<meta property="og:title" content="Install Gerrit on Tomcat_Apache on Windows">
<meta property="og:description" content="notes, articles, or reproduced">
<meta property="og:url" content="/cm/git/install-gerrit-on-tomcat/">
<meta property="og:site_name" content="wi's Tech Blog">
<meta property="og:image" content="/images/images/avatar.png">





<link rel="canonical" href="/cm/git/install-gerrit-on-tomcat/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="wi's Tech Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/jquery.mmenu.all.css">
<link rel="stylesheet" href="/assets/css/jquery.floating-social-share.min.css">
<!-- Webfonts -->

<meta http-equiv="cleartype" content="on">

<script type="text/javascript">window.jQuery || document.write('<script type="text/javascript" src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script type="text/javascript" src="/assets/js/scripts.min.js"></script>

<!-- table of content -->
<script type="text/javascript" src="/assets/js/vendor/toc.js"></script>


<!-- Load Modernizr -->
<script type="text/javascript" src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>


<!-- Mathjax Support -->
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">




</head>

<body>

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->



<div class="header-menu header-menu-top">
    <ul class="header-item-container">
      <li class="header-item-title header-toggle "><a href="#menu"><i class="fa fa-bars"></i></a></li>
      <li class="header-item-title">
        <a href="/">
          
            <img class="logo" src="/images/avatar.png" alt="wi's Tech Blog">
          
          <a href="/" class="title"> wi's Tech Blog</a>
        </a>
      </li>
      
        
        


        
            
                <li class="header-item "><a href="/favorites">fav</a></li>
            
        
      
        
        


        
            
                <li class="header-item "><a href="/categories">Categories</a></li>
            
        
      
        
        


        
            
                <li class="header-item "><a href="/tags">Tags</a></li>
            
        
      
        
        


        
            
                <li class="header-item "><a href="/">Home</a></li>
            
        
      
      <li class="header-item"><a href="/search"><i class="fa fa-search"></i></a></li>
    </ul>
  </div>



<nav id="menu" style="display: none">
  <ul>
    
      
        <li><a href="/"><h3>Home</h3></a></li>
      
    
      
        <li><a href="/tags"><h3>Tags</h3></a></li>
      
    
      
        <li><a href="/categories"><h3>Categories</h3></a>
          <ul>
            
              
                <li><a href="/categories/#UML">UML</a></li>
            
              
                <li><a href="/categories/#Windows">Windows</a></li>
            
              
                <li><a href="/categories/#adb">adb</a></li>
            
              
                <li><a href="/categories/#adt">adt</a></li>
            
              
                <li><a href="/categories/#android">android</a></li>
            
              
                <li><a href="/categories/#apache">apache</a></li>
            
              
                <li><a href="/categories/#apple">apple</a></li>
            
              
                <li><a href="/categories/#bat">bat</a></li>
            
              
                <li><a href="/categories/#blog">blog</a></li>
            
              
                <li><a href="/categories/#blog_sample">blog_sample</a></li>
            
              
                <li><a href="/categories/#browser">browser</a></li>
            
              
                <li><a href="/categories/#burpsuite">burpsuite</a></li>
            
              
                <li><a href="/categories/#centos">centos</a></li>
            
              
                <li><a href="/categories/#chrome">chrome</a></li>
            
              
                <li><a href="/categories/#cm">cm</a></li>
            
              
                <li><a href="/categories/#common">common</a></li>
            
              
                <li><a href="/categories/#css">css</a></li>
            
              
                <li><a href="/categories/#cygwin">cygwin</a></li>
            
              
                <li><a href="/categories/#database">database</a></li>
            
              
                <li><a href="/categories/#db">db</a></li>
            
              
                <li><a href="/categories/#dev">dev</a></li>
            
              
                <li><a href="/categories/#device">device</a></li>
            
              
                <li><a href="/categories/#diff">diff</a></li>
            
              
                <li><a href="/categories/#disk">disk</a></li>
            
              
                <li><a href="/categories/#diy">diy</a></li>
            
              
                <li><a href="/categories/#dns">dns</a></li>
            
              
                <li><a href="/categories/#doc">doc</a></li>
            
              
                <li><a href="/categories/#docker">docker</a></li>
            
              
                <li><a href="/categories/#efi">efi</a></li>
            
              
                <li><a href="/categories/#emacs">emacs</a></li>
            
              
                <li><a href="/categories/#email">email</a></li>
            
              
                <li><a href="/categories/#emulator">emulator</a></li>
            
              
                <li><a href="/categories/#english">english</a></li>
            
              
                <li><a href="/categories/#esxi">esxi</a></li>
            
              
                <li><a href="/categories/#excel">excel</a></li>
            
              
                <li><a href="/categories/#exsi">exsi</a></li>
            
              
                <li><a href="/categories/#favorites">favorites</a></li>
            
              
                <li><a href="/categories/#ftp">ftp</a></li>
            
              
                <li><a href="/categories/#game">game</a></li>
            
              
                <li><a href="/categories/#git">git</a></li>
            
              
                <li><a href="/categories/#gitlab">gitlab</a></li>
            
              
                <li><a href="/categories/#go">go</a></li>
            
              
                <li><a href="/categories/#golang">golang</a></li>
            
              
                <li><a href="/categories/#hardware">hardware</a></li>
            
              
                <li><a href="/categories/#ide">ide</a></li>
            
              
                <li><a href="/categories/#internet">internet</a></li>
            
              
                <li><a href="/categories/#java">java</a></li>
            
              
                <li><a href="/categories/#javascript">javascript</a></li>
            
              
                <li><a href="/categories/#jekyll">jekyll</a></li>
            
              
                <li><a href="/categories/#jenkins">jenkins</a></li>
            
              
                <li><a href="/categories/#jmeter">jmeter</a></li>
            
              
                <li><a href="/categories/#kate">kate</a></li>
            
              
                <li><a href="/categories/#kde">kde</a></li>
            
              
                <li><a href="/categories/#ldap">ldap</a></li>
            
              
                <li><a href="/categories/#learn">learn</a></li>
            
              
                <li><a href="/categories/#learning">learning</a></li>
            
              
                <li><a href="/categories/#links">links</a></li>
            
              
                <li><a href="/categories/#linux">linux</a></li>
            
              
                <li><a href="/categories/#living">living</a></li>
            
              
                <li><a href="/categories/#mac">mac</a></li>
            
              
                <li><a href="/categories/#mac-os">mac-os</a></li>
            
              
                <li><a href="/categories/#macos">macos</a></li>
            
              
                <li><a href="/categories/#mail">mail</a></li>
            
              
                <li><a href="/categories/#manjaro">manjaro</a></li>
            
              
                <li><a href="/categories/#markdown">markdown</a></li>
            
              
                <li><a href="/categories/#maven">maven</a></li>
            
              
                <li><a href="/categories/#memcached">memcached</a></li>
            
              
                <li><a href="/categories/#microsoft">microsoft</a></li>
            
              
                <li><a href="/categories/#moco">moco</a></li>
            
              
                <li><a href="/categories/#mysql">mysql</a></li>
            
              
                <li><a href="/categories/#nas">nas</a></li>
            
              
                <li><a href="/categories/#ndk">ndk</a></li>
            
              
                <li><a href="/categories/#netbean">netbean</a></li>
            
              
                <li><a href="/categories/#network">network</a></li>
            
              
                <li><a href="/categories/#netwrok">netwrok</a></li>
            
              
                <li><a href="/categories/#nginx">nginx</a></li>
            
              
                <li><a href="/categories/#nodejs">nodejs</a></li>
            
              
                <li><a href="/categories/#notepad++">notepad++</a></li>
            
              
                <li><a href="/categories/#office">office</a></li>
            
              
                <li><a href="/categories/#open-course">open-course</a></li>
            
              
                <li><a href="/categories/#openkm">openkm</a></li>
            
              
                <li><a href="/categories/#openwrt">openwrt</a></li>
            
              
                <li><a href="/categories/#outlook">outlook</a></li>
            
              
                <li><a href="/categories/#pdf">pdf</a></li>
            
              
                <li><a href="/categories/#perl">perl</a></li>
            
              
                <li><a href="/categories/#phone">phone</a></li>
            
              
                <li><a href="/categories/#php">php</a></li>
            
              
                <li><a href="/categories/#postgresql">postgresql</a></li>
            
              
                <li><a href="/categories/#product">product</a></li>
            
              
                <li><a href="/categories/#python">python</a></li>
            
              
                <li><a href="/categories/#rails">rails</a></li>
            
              
                <li><a href="/categories/#redmine">redmine</a></li>
            
              
                <li><a href="/categories/#regex">regex</a></li>
            
              
                <li><a href="/categories/#router">router</a></li>
            
              
                <li><a href="/categories/#ruby">ruby</a></li>
            
              
                <li><a href="/categories/#search-engine">search-engine</a></li>
            
              
                <li><a href="/categories/#security">security</a></li>
            
              
                <li><a href="/categories/#sed">sed</a></li>
            
              
                <li><a href="/categories/#ssh">ssh</a></li>
            
              
                <li><a href="/categories/#streaming">streaming</a></li>
            
              
                <li><a href="/categories/#study">study</a></li>
            
              
                <li><a href="/categories/#subversion">subversion</a></li>
            
              
                <li><a href="/categories/#tcpdump">tcpdump</a></li>
            
              
                <li><a href="/categories/#tech">tech</a></li>
            
              
                <li><a href="/categories/#testing">testing</a></li>
            
              
                <li><a href="/categories/#testlink">testlink</a></li>
            
              
                <li><a href="/categories/#text">text</a></li>
            
              
                <li><a href="/categories/#tomcat">tomcat</a></li>
            
              
                <li><a href="/categories/#ubuntu">ubuntu</a></li>
            
              
                <li><a href="/categories/#ufw">ufw</a></li>
            
              
                <li><a href="/categories/#vbs">vbs</a></li>
            
              
                <li><a href="/categories/#vim">vim</a></li>
            
              
                <li><a href="/categories/#virtual-box">virtual-box</a></li>
            
              
                <li><a href="/categories/#virtualbox">virtualbox</a></li>
            
              
                <li><a href="/categories/#virtualization">virtualization</a></li>
            
              
                <li><a href="/categories/#vm">vm</a></li>
            
              
                <li><a href="/categories/#vpn">vpn</a></li>
            
              
                <li><a href="/categories/#web">web</a></li>
            
              
                <li><a href="/categories/#windows">windows</a></li>
            
              
                <li><a href="/categories/#xampp">xampp</a></li>
            
              
                <li><a href="/categories/#收藏夹">收藏夹</a></li>
            
              
                <li><a href="/categories/#测试工具">测试工具</a></li>
            
              
                <li><a href="/categories/#玩机">玩机</a></li>
            
          </ul>
        </li>
      
    
      
        <li><a href="/favorites"><h3>fav</h3></a></li>
      
    
  </ul>
</nav>




<div id="post" >
<div id="main" role="main" >
  <article class="hentry">
    <div class="entry-content">
        
      <h1 class="post-title entry-title">Install Gerrit on Tomcat_Apache on Windows</h1>
      
        <h3><span class="entry-date date published updated"><time datetime="2015-02-26T00:00:00+08:00">February 26, 2015</time></span></h3>
      
      
      
      
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 60);
  return false
})

$(".toc-button").on('click', function(){
  $(".toc").toggle();
});


$(window).click(function(evt){
  if( !evt.target.matches('.toc') 
      && !evt.target.matches('.toc>ul') 
      && !evt.target.matches('.toc-button') ) {
    $('.toc').each(function(){
      if( $(this).is(":visible") ) {
        $(this).hide();
      }
    });
  }
});

});
</script>

<div class="float-toc">
    <i class="toc-button fa fa-list-ol" aria-hidden="true"></i>
  <div id="toc"></div>
</div>

      
      
      <h2 id="安装步骤">安装步骤</h2>

<h3 id="下载gerrit">下载Gerrit</h3>

<p><a href="https://code.google.com/p/gerrit/">https://code.google.com/p/gerrit/</a></p>

<p>下载下来是个war包，例如：gerrit-2.8.1.war</p>

<h3 id="创建gerrit用的数据库mysql">创建Gerrit用的数据库（MySql）</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">ReviewDB</span><span class="p">;</span> 
<span class="k">ALTER</span> <span class="k">DATABASE</span> <span class="n">ReviewDB</span> <span class="n">charset</span><span class="o">=</span><span class="n">latin1</span><span class="p">;</span> 
<span class="k">CREATE</span> <span class="k">USER</span> <span class="s1">'gerrit'</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'gerrit'</span><span class="p">;</span> 
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">ON</span> <span class="n">ReviewDB</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'gerrit'</span><span class="o">@</span><span class="s1">'localhost'</span><span class="p">;</span> 
<span class="n">FLUSH</span> <span class="k">PRIVILEGES</span><span class="p">;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>charset=latin1 ， 字符集先设置成latin1，原因有2个说法：</p>

<ol>
  <li>gerrit.war init 安装出错</li>
  <li>mysql的主键长度不能超过1000个字节，用utf8（1个字符3字节）会严重减少描述的字符。
    <ul>
      <li>参考：<a href="http://code.google.com/p/gerrit/issues/detail?id=785#makechanges">http://code.google.com/p/gerrit/issues/detail?id=785#makechanges</a></li>
    </ul>
  </li>
</ol>

<p>中文支持配置，创建完数据库后就进行配置，参见<a href="#chinese-support">中文支持部分</a>。</p>

<h3 id="创建gerrit网站包含git-repo">创建Gerrit网站（包含git repo）</h3>

<p>java -jar gerrit.war init -d /path/to/your/gerrit_application_directory</p>

<p>如下示意图，执行的是：java -jar gerrit-2.8.1.war init -d e:\gerrit\gerrit_server</p>

<p><img src="/images/cm/git/gerrit/gerrit_site_init.png" alt="" /></p>

<p>执行后，gerrit_server目录结构类似如下：</p>

<p><img src="/images/cm/git/gerrit/gerrit_site_dir.png" alt="" /></p>

<p>数据库结构类似如下：</p>

<p><img src="/images/cm/git/gerrit/gerrit_site_database.png" alt="" /></p>

<h4 id="gerrit_serveretcgerritconfig">gerrit_server/etc/gerrit.config</h4>

<p>文件类似如下：</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></td><td class="code"><pre><span class="pi">[</span><span class="nv">gerrit</span><span class="pi">]</span>
    <span class="s">basePath = git</span>
    <span class="s">canonicalWebUrl = http://localhost:8080/</span>
<span class="pi">[</span><span class="nv">database</span><span class="pi">]</span>
    <span class="s">type = mysql</span>
    <span class="s">hostname = localhost</span>
    <span class="s">port = 3306</span>
    <span class="s">database = reviewdb</span>
    <span class="s">username = root</span>
<span class="pi">[</span><span class="nv">auth</span><span class="pi">]</span>
    <span class="s">type = HTTP</span>
    <span class="s">httpHeader = Authorization</span>
<span class="pi">[</span><span class="nv">sendemail</span><span class="pi">]</span>
    <span class="s">smtpServer = smtp.126.com</span>
    <span class="s">smtpServerPort = 25</span>
    <span class="s">smtpUser = your-email@126.com</span>
    <span class="s">from = your-email@126.com</span>
<span class="pi">[</span><span class="nv">container</span><span class="pi">]</span>
    <span class="s">user = ethan</span>
    <span class="s">javaHome = e:\\sdk\\Java\\jre6</span>
<span class="pi">[</span><span class="nv">sshd</span><span class="pi">]</span>
    <span class="s">listenAddress = *:29418</span>
<span class="pi">[</span><span class="nv">httpd</span><span class="pi">]</span>
    <span class="s">listenUrl = http://*:8080/</span>
<span class="pi">[</span><span class="nv">cache</span><span class="pi">]</span>
    <span class="s">directory = cache</span>
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="配置tomcat">配置Tomcat</h3>

<ul>
  <li>注意：Gerrit 2.8.1 不能在 tomcat6 上跑，只能在 <strong>tomcat7</strong> 以上。</li>
</ul>

<p>解压war包到某个目录，例如：E:\server\gerrit\gerrit-2.8.1</p>

<p>创建 &lt;tomcat-home&gt;/conf/Catalina/localhost/gerrit.xml</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> 
<span class="nt">&lt;Context</span> <span class="na">path=</span><span class="s">""</span> <span class="na">docBase=</span><span class="s">"E:/server/gerrit/gerrit-2.8.1"</span><span class="nt">/&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>此时，可以将gerrit.config的设置，该为：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>canonicalWebUrl = http://localhost:8080/gerrit
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="创建db-source">创建DB Source</h4>

<p>&lt;tomcat-home&gt;/conf/context.xml中添加：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="nt">&lt;Resource</span>  
<span class="na">name=</span><span class="s">"jdbc/ReviewDb"</span>  
<span class="na">type=</span><span class="s">"javax.sql.DataSource"</span>  
<span class="na">driverClassName=</span><span class="s">"com.mysql.jdbc.Driver"</span>  
<span class="na">username=</span><span class="s">"gerrit"</span>  
<span class="na">password=</span><span class="s">"gerrit"</span>  
<span class="na">url=</span><span class="s">"jdbc:mysql://localhost:7655/ReviewDB?autoReconnect=true"</span>  
<span class="na">auth=</span><span class="s">"Container"</span> 
<span class="nt">/&gt;</span>
</pre></td></tr></tbody></table>
</div>
</div>

<p>同时记得将 mysql-connector 从 gerrit_server/lib/mysql-connector-java-5.1.21.jar 拷贝到 &lt;tomcat-home&gt;/lib</p>

<h3 id="运行tomcat下的gerrit">运行tomcat下的gerrit</h3>

<p>http://localhost:8080/gerrit就可以看到页面了。</p>

<h3 id="配置帐号结合apache的http-basic-authorization">配置帐号（结合Apache的Http Basic Authorization）</h3>

<h4 id="配置apache成为tomcat的反向代理">配置Apache成为tomcat的反向代理</h4>

<p>在httpd.conf加入：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td class="code"><pre>Listen 7666
&lt;VirtualHost *:7666&gt;
  ErrorLog "logs/error_log"
  CustomLog "logs/access_log" vcommon
 
  ProxyRequests Off
  ProxyVia Off
  ProxyPreserveHost On
 
  &lt;Proxy *&gt;
      Order deny,allow
      Allow from all
  &lt;/Proxy&gt;
 
  &lt;Location /gerrit/login/&gt;
       AuthType Basic
       AuthName "Gerrit Code Review"
       AuthUserFile passwords
       AuthGroupFile group.txt
       Require group review
       Order Deny,Allow
       Allow from all
  &lt;/Location&gt;
 
  ProxyPass /gerrit/ http://127.0.0.1:8080/gerrit/
    ProxyPassReverse /gerrit/ http://127.0.0.1:8080/gerrit/
&lt;/VirtualHost&gt;
</pre></td></tr></tbody></table>
</div>
</div>

<h4 id="创建用户名和密码">创建用户名和密码</h4>

<p>上述httpd.conf中 AuthUserFile passwords，执行apache根目录下的passwords文件保存用名和密码。</p>

<p>使用如下命令创建用户，命令会自动弹出来要求输入密码。</p>

<p>htpasswd -c Filename username</p>

<h4 id="创建用户组">创建用户组</h4>

<p>上述httpd.conf中 AuthGroupFile group.txt 指明组文件，文件格式为：</p>

<p>group-name: user1 user2</p>

<p>例如：group.txt</p>

<p>review: wi</p>

<h4 id="设置用户权限">设置用户权限</h4>

<p>Require group review</p>

<p>修改gerrit.config 配置</p>

<h3 id="启动apache并访问gerrit">启动Apache并访问gerrit</h3>

<p>将gerrit.config的设置，该为：<br />
canonicalWebUrl = http://localhost:7666/gerrit/</p>

<p>并从该地址访问。</p>

<h2 id="gerrit-服务器迁移">Gerrit 服务器迁移</h2>

<p>将备份的数据库导入后，需要在执行下配置：</p>

<p>java -jar gerrit-2.8.1.war init -d /opt/server/gerrit/gerrit-2.8.1-site</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre></td><td class="code"><pre>----------------------------------------------------------


*** Gerrit Code Review 2.8.1
*** 


*** Git Repositories
*** 

Location of Git repositories   [git]: 

*** SQL Database
*** 

Database server type           [mysql]: 
Server hostname                [localhost]: 
Server port                    [(mysql default)]: 
Database name                  [ReviewDB]: 
Database username              [gerrit]: 
Change gerrit's password       [y/N]? 

*** User Authentication
*** 

Authentication method          [LDAP/?]: 
LDAP server                    [ldap://localhost]: 
LDAP username                  [cn=Manager,dc=duzzle,dc=com]: 
Change cn=Manager,dc=duzzle,dc=com's password [y/N]? 
Account BaseDN                 [ou=people,dc=duzzle,dc=com]: 
Group BaseDN                   [ou=people,dc=duzzle,dc=com]: 

*** Email Delivery
*** 

SMTP server hostname           [smtp.126.com]: 
SMTP server port               [(default)]: 
SMTP encryption                [NONE/?]: 
SMTP username                  [testdirector8@126.com]: 
Change testdirector8@126.com's password [y/N]? 

*** Container Process
*** 

Run as                         [root]: 
Java runtime                   [/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.75.x86_64/jre]: 
Upgrade /opt/server/gerrit/gerrit-2.8.1-site/bin/gerrit.war [Y/n]? 
Copying gerrit-2.8.1.war to /opt/server/gerrit/gerrit-2.8.1-site/bin/gerrit.war




*** SSH Daemon
*** 

Listen on address              [*]: Listen on port                 [29418]: 
*** HTTP Daemon
*** 

Behind reverse proxy           [y/N]? Use SSL (https://)             [y/N]? 
Listen on address              [*]: 
Listen on port                 [8080]: 
Canonical URL                  [http://192.168.251.90:8080/gerrit/]: 

*** Plugins
*** 

Install plugin download-commands version v2.8.1 [y/N]? 
Install plugin reviewnotes version v2.8.1 [y/N]? 
Install plugin replication version v2.8.1 [y/N]? 
Install plugin commit-message-length-validator version v2.8.1 [y/N]? 

Initialized /opt/server/gerrit/gerrit-2.8.1-site
----------------------------------------------------------
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="中文支持">中文支持</h2>

<p><a name="chinese-support"></a></p>

<h3 id="mysql-对gerrit中文支持">mysql 对gerrit中文支持</h3>

<p>安装完成后，Commit Subject 中中文显示为“？”，查了下mysql，库里边就是乱码。</p>

<h4 id="解决方法">解决方法：</h4>

<h5 id="修改mysql服务器设置">修改mysql服务器设置</h5>

<p>修改mysql设置，在my.ini设置：</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>[mysqld]
character-set-server = utf8
character-set-filesystem = utf8
</pre></td></tr></tbody></table>
</div>
</div>

<h5 id="修改reviewdb中的character设置">修改reviewdb中的character设置</h5>

<p>gerrit-x.x.war init 出默认的数据库，参见安装步骤。</p>

<p>导出数据库。</p>

<p>mysqldump –opt -p -u root –port=your-custom-port reviewdb &gt; reviewdb.sql</p>

<p>拷贝出reviewdb_utf8.sql，修改reviewdb_utf8.sql中latin1为utf8的设置。</p>

<ol>
  <li>First replace: latin1_bin for utf8_unicode_ci ; this is the COLLATE  latin1 value</li>
  <li>Second replace: latin1 for utf8 . Replacing this after the COLLATE operation near guarantees you won’t have “utf8_bin”, which we don’t want.</li>
  <li>Third replace: ENGINE=MyISAM for ENGINE=INNODB. This way, tables are recreated using INNODB, which actually also seems to be faster, though this might just be a placebo effect.</li>
</ol>

<p>将新的sql导入数据。</p>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>DROP DATABASE reviewdb;
CREATE DATABASE reviewdb;
mysql -u --port=7655 -u root reviewdb &lt; reviewdb_utf8.sql
</pre></td></tr></tbody></table>
</div>
</div>

<p>参考</p>

<p>http://blog.csdn.net/yz2574648679/article/details/10362747<br />
http://scn.sap.com/docs/DOC-42271<br />
http://stackoverflow.com/a/8451748</p>


      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags#cm" title="Pages tagged cm" class="tag"><span class="term">cm</span></a><a href="/tags#git" title="Pages tagged git" class="tag"><span class="term">git</span></a><a href="/tags#tomcat" title="Pages tagged tomcat" class="tag"><span class="term">tomcat</span></a></span>
        
        
      </footer>
    </div><!-- /.entry-content -->
    
    
    
  </article>
</div><!-- /#main -->
</div><!-- post container -->














<script type="text/javascript">
  // embeded-iframe
  $(window).load(function(){
    $('.embeded-iframe').each(function(){
      $(this).height($(this).contents().find('html').height());
    });
  });
</script>





<div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2023 wi. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://github.com/aron-bordin/neo-hpstr-jekyll-theme" rel="nofollow">Neo-HPSTR Theme</a>.</span>

<script src="/assets/js/main.js?20230725301728281823445"></script>

  </footer>
</div><!-- /.footer-wrapper -->

</body>
</html>
