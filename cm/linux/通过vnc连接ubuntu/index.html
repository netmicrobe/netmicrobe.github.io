<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>通过vnc连接linux，关联 ubuntu, debian, realvnc, tigervnc, vnc-viewer, vncserver &#8211; wi's Tech Blog</title>
<meta name="description" content="notes, articles, or reproduced">
<meta name="keywords" content="">



<!-- Open Graph -->
<meta property="og:locale" content="zh_CN">
<meta property="og:type" content="article">
<meta property="og:title" content="通过vnc连接linux，关联 ubuntu, debian, realvnc, tigervnc, vnc-viewer, vncserver">
<meta property="og:description" content="notes, articles, or reproduced">
<meta property="og:url" content="/cm/linux/%E9%80%9A%E8%BF%87vnc%E8%BF%9E%E6%8E%A5ubuntu/">
<meta property="og:site_name" content="wi's Tech Blog">
<meta property="og:image" content="/images/images/avatar.png">





<link rel="canonical" href="/cm/linux/%E9%80%9A%E8%BF%87vnc%E8%BF%9E%E6%8E%A5ubuntu/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="wi's Tech Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="/assets/css/jquery.mmenu.all.css">
<link rel="stylesheet" href="/assets/css/jquery.floating-social-share.min.css">
<!-- Webfonts -->

<meta http-equiv="cleartype" content="on">

<script type="text/javascript">window.jQuery || document.write('<script type="text/javascript" src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script type="text/javascript" src="/assets/js/scripts.min.js"></script>

<!-- table of content -->
<script type="text/javascript" src="/assets/js/vendor/toc.js"></script>


<!-- Load Modernizr -->
<script type="text/javascript" src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>


<!-- Mathjax Support -->
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">




</head>

<body>

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->



<div class="header-menu header-menu-top">
    <ul class="header-item-container">
      <li class="header-item-title header-toggle "><a href="#menu"><i class="fa fa-bars"></i></a></li>
      <li class="header-item-title">
        <a href="/">
          
            <img class="logo" src="/images/avatar.png" alt="wi's Tech Blog">
          
          <a href="/" class="title"> wi's Tech Blog</a>
        </a>
      </li>
      
        
        


        
            
                <li class="header-item "><a href="/favorites">fav</a></li>
            
        
      
        
        


        
            
                <li class="header-item "><a href="/categories">Categories</a></li>
            
        
      
        
        


        
            
                <li class="header-item "><a href="/tags">Tags</a></li>
            
        
      
        
        


        
            
                <li class="header-item "><a href="/">Home</a></li>
            
        
      
      <li class="header-item"><a href="/search"><i class="fa fa-search"></i></a></li>
    </ul>
  </div>



<nav id="menu" style="display: none">
  <ul>
    
      
        <li><a href="/"><h3>Home</h3></a></li>
      
    
      
        <li><a href="/tags"><h3>Tags</h3></a></li>
      
    
      
        <li><a href="/categories"><h3>Categories</h3></a>
          <ul>
            
              
                <li><a href="/categories/#UML">UML</a></li>
            
              
                <li><a href="/categories/#Windows">Windows</a></li>
            
              
                <li><a href="/categories/#adb">adb</a></li>
            
              
                <li><a href="/categories/#adt">adt</a></li>
            
              
                <li><a href="/categories/#android">android</a></li>
            
              
                <li><a href="/categories/#apache">apache</a></li>
            
              
                <li><a href="/categories/#apple">apple</a></li>
            
              
                <li><a href="/categories/#bat">bat</a></li>
            
              
                <li><a href="/categories/#blog">blog</a></li>
            
              
                <li><a href="/categories/#blog_sample">blog_sample</a></li>
            
              
                <li><a href="/categories/#browser">browser</a></li>
            
              
                <li><a href="/categories/#burpsuite">burpsuite</a></li>
            
              
                <li><a href="/categories/#centos">centos</a></li>
            
              
                <li><a href="/categories/#chrome">chrome</a></li>
            
              
                <li><a href="/categories/#cm">cm</a></li>
            
              
                <li><a href="/categories/#common">common</a></li>
            
              
                <li><a href="/categories/#css">css</a></li>
            
              
                <li><a href="/categories/#cygwin">cygwin</a></li>
            
              
                <li><a href="/categories/#database">database</a></li>
            
              
                <li><a href="/categories/#db">db</a></li>
            
              
                <li><a href="/categories/#dev">dev</a></li>
            
              
                <li><a href="/categories/#device">device</a></li>
            
              
                <li><a href="/categories/#diff">diff</a></li>
            
              
                <li><a href="/categories/#disk">disk</a></li>
            
              
                <li><a href="/categories/#diy">diy</a></li>
            
              
                <li><a href="/categories/#dns">dns</a></li>
            
              
                <li><a href="/categories/#doc">doc</a></li>
            
              
                <li><a href="/categories/#docker">docker</a></li>
            
              
                <li><a href="/categories/#efi">efi</a></li>
            
              
                <li><a href="/categories/#emacs">emacs</a></li>
            
              
                <li><a href="/categories/#email">email</a></li>
            
              
                <li><a href="/categories/#emulator">emulator</a></li>
            
              
                <li><a href="/categories/#english">english</a></li>
            
              
                <li><a href="/categories/#esxi">esxi</a></li>
            
              
                <li><a href="/categories/#excel">excel</a></li>
            
              
                <li><a href="/categories/#exsi">exsi</a></li>
            
              
                <li><a href="/categories/#favorites">favorites</a></li>
            
              
                <li><a href="/categories/#ftp">ftp</a></li>
            
              
                <li><a href="/categories/#game">game</a></li>
            
              
                <li><a href="/categories/#git">git</a></li>
            
              
                <li><a href="/categories/#gitlab">gitlab</a></li>
            
              
                <li><a href="/categories/#go">go</a></li>
            
              
                <li><a href="/categories/#golang">golang</a></li>
            
              
                <li><a href="/categories/#hardware">hardware</a></li>
            
              
                <li><a href="/categories/#ide">ide</a></li>
            
              
                <li><a href="/categories/#internet">internet</a></li>
            
              
                <li><a href="/categories/#java">java</a></li>
            
              
                <li><a href="/categories/#javascript">javascript</a></li>
            
              
                <li><a href="/categories/#jekyll">jekyll</a></li>
            
              
                <li><a href="/categories/#jenkins">jenkins</a></li>
            
              
                <li><a href="/categories/#jmeter">jmeter</a></li>
            
              
                <li><a href="/categories/#kate">kate</a></li>
            
              
                <li><a href="/categories/#kde">kde</a></li>
            
              
                <li><a href="/categories/#ldap">ldap</a></li>
            
              
                <li><a href="/categories/#learn">learn</a></li>
            
              
                <li><a href="/categories/#learning">learning</a></li>
            
              
                <li><a href="/categories/#links">links</a></li>
            
              
                <li><a href="/categories/#linux">linux</a></li>
            
              
                <li><a href="/categories/#living">living</a></li>
            
              
                <li><a href="/categories/#mac">mac</a></li>
            
              
                <li><a href="/categories/#mac-os">mac-os</a></li>
            
              
                <li><a href="/categories/#macos">macos</a></li>
            
              
                <li><a href="/categories/#mail">mail</a></li>
            
              
                <li><a href="/categories/#manjaro">manjaro</a></li>
            
              
                <li><a href="/categories/#markdown">markdown</a></li>
            
              
                <li><a href="/categories/#maven">maven</a></li>
            
              
                <li><a href="/categories/#memcached">memcached</a></li>
            
              
                <li><a href="/categories/#microsoft">microsoft</a></li>
            
              
                <li><a href="/categories/#moco">moco</a></li>
            
              
                <li><a href="/categories/#mysql">mysql</a></li>
            
              
                <li><a href="/categories/#nas">nas</a></li>
            
              
                <li><a href="/categories/#ndk">ndk</a></li>
            
              
                <li><a href="/categories/#netbean">netbean</a></li>
            
              
                <li><a href="/categories/#network">network</a></li>
            
              
                <li><a href="/categories/#netwrok">netwrok</a></li>
            
              
                <li><a href="/categories/#nginx">nginx</a></li>
            
              
                <li><a href="/categories/#nodejs">nodejs</a></li>
            
              
                <li><a href="/categories/#notepad++">notepad++</a></li>
            
              
                <li><a href="/categories/#office">office</a></li>
            
              
                <li><a href="/categories/#open-course">open-course</a></li>
            
              
                <li><a href="/categories/#openkm">openkm</a></li>
            
              
                <li><a href="/categories/#openwrt">openwrt</a></li>
            
              
                <li><a href="/categories/#outlook">outlook</a></li>
            
              
                <li><a href="/categories/#pdf">pdf</a></li>
            
              
                <li><a href="/categories/#perl">perl</a></li>
            
              
                <li><a href="/categories/#phone">phone</a></li>
            
              
                <li><a href="/categories/#php">php</a></li>
            
              
                <li><a href="/categories/#postgresql">postgresql</a></li>
            
              
                <li><a href="/categories/#product">product</a></li>
            
              
                <li><a href="/categories/#python">python</a></li>
            
              
                <li><a href="/categories/#rails">rails</a></li>
            
              
                <li><a href="/categories/#redmine">redmine</a></li>
            
              
                <li><a href="/categories/#regex">regex</a></li>
            
              
                <li><a href="/categories/#router">router</a></li>
            
              
                <li><a href="/categories/#ruby">ruby</a></li>
            
              
                <li><a href="/categories/#search-engine">search-engine</a></li>
            
              
                <li><a href="/categories/#security">security</a></li>
            
              
                <li><a href="/categories/#sed">sed</a></li>
            
              
                <li><a href="/categories/#ssh">ssh</a></li>
            
              
                <li><a href="/categories/#streaming">streaming</a></li>
            
              
                <li><a href="/categories/#study">study</a></li>
            
              
                <li><a href="/categories/#subversion">subversion</a></li>
            
              
                <li><a href="/categories/#tcpdump">tcpdump</a></li>
            
              
                <li><a href="/categories/#tech">tech</a></li>
            
              
                <li><a href="/categories/#testing">testing</a></li>
            
              
                <li><a href="/categories/#testlink">testlink</a></li>
            
              
                <li><a href="/categories/#text">text</a></li>
            
              
                <li><a href="/categories/#tomcat">tomcat</a></li>
            
              
                <li><a href="/categories/#ubuntu">ubuntu</a></li>
            
              
                <li><a href="/categories/#ufw">ufw</a></li>
            
              
                <li><a href="/categories/#vbs">vbs</a></li>
            
              
                <li><a href="/categories/#vim">vim</a></li>
            
              
                <li><a href="/categories/#virtual-box">virtual-box</a></li>
            
              
                <li><a href="/categories/#virtualbox">virtualbox</a></li>
            
              
                <li><a href="/categories/#virtualization">virtualization</a></li>
            
              
                <li><a href="/categories/#vm">vm</a></li>
            
              
                <li><a href="/categories/#vpn">vpn</a></li>
            
              
                <li><a href="/categories/#web">web</a></li>
            
              
                <li><a href="/categories/#windows">windows</a></li>
            
              
                <li><a href="/categories/#xampp">xampp</a></li>
            
              
                <li><a href="/categories/#收藏夹">收藏夹</a></li>
            
              
                <li><a href="/categories/#测试工具">测试工具</a></li>
            
              
                <li><a href="/categories/#玩机">玩机</a></li>
            
          </ul>
        </li>
      
    
      
        <li><a href="/favorites"><h3>fav</h3></a></li>
      
    
  </ul>
</nav>




<div id="post" >
<div id="main" role="main" >
  <article class="hentry">
    <div class="entry-content">
        
      <h1 class="post-title entry-title">通过vnc连接linux，关联 ubuntu, debian, realvnc, tigervnc, vnc-viewer, vncserver</h1>
      
        <h3><span class="entry-date date published updated"><time datetime="2021-03-07T00:00:00+08:00">March 07, 2021</time></span></h3>
      
      
      
      
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 60);
  return false
})

$(".toc-button").on('click', function(){
  $(".toc").toggle();
});


$(window).click(function(evt){
  if( !evt.target.matches('.toc') 
      && !evt.target.matches('.toc>ul') 
      && !evt.target.matches('.toc-button') ) {
    $('.toc').each(function(){
      if( $(this).is(":visible") ) {
        $(this).hide();
      }
    });
  }
});

});
</script>

<div class="float-toc">
    <i class="toc-button fa fa-list-ol" aria-hidden="true"></i>
  <div id="toc"></div>
</div>

      
      
      <ul>
  <li>参考：
    <ul>
      <li><a href="https://www.youtube.com/watch?v=NaI6lB87HM0">Ubuntu 16.04 VMWare Install and Remote Desktop Setup</a></li>
      <li><a href="https://www.nakivo.com/blog/how-to-use-remote-desktop-connection-ubuntu-linux-walkthrough/">How to Use Remote Desktop Connection in Ubuntu Linux: Complete Walkthrough</a></li>
      <li><a href="https://www.lijiejie.com/ubuntu-vps-config-lxde-vnc/">Ubuntu VPS配置轻量级图形桌面LXDE和VNC</a></li>
      <li><a href=""></a></li>
    </ul>
  </li>
</ul>

<h2 id="ubuntu-2004-上安装vnc-server">Ubuntu 20.04 上安装VNC Server</h2>

<ul>
  <li>参考：
    <ul>
      <li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-vnc-on-ubuntu-20-04">digitalocean.com - How to Install and Configure VNC on Ubuntu 20.04</a></li>
      <li>
        <table>
          <tbody>
            <tr>
              <td>[Install and Configure VNC Server on Ubuntu 20.04</td>
              <td>18.04](https://techviewleo.com/install-and-configure-vnc-server-on-ubuntu/)</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li><a href="https://linuxconfig.org/vnc-server-on-ubuntu-20-04-focal-fossa-linux">VNC server on Ubuntu 20.04 Focal Fossa Linux</a></li>
      <li><a href="https://www.answertopia.com/ubuntu/ubuntu-remote-desktop-access-with-vnc/">Ubuntu 20.04 Remote Desktop Access with VNC</a></li>
      <li><a href="https://serverspace.io/support/help/install-tightvnc-server-on-ubuntu-20-04/">How to Install TightVNC Server on Ubuntu 20.04</a></li>
      <li><a href=""></a></li>
    </ul>
  </li>
</ul>

<h3 id="xfce4-desktop">xfce4 desktop</h3>

<ol>
  <li>安装 xfce4 desktop + vnc server
    <div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre> sudo apt update

 <span class="c"># 安装 xfce4 桌面，选择 lightdm</span>
 sudo apt install xfce4 xfce4-goodies
</pre></td></tr></tbody></table>
</div>
    </div>

    <div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre> <span class="c"># 安装 vnc server</span>
 sudo apt install tightvncserver
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>配置
    <div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre> <span class="c"># 设置VNC 访问密码，密码长度要求在 6-8个字符，超过8个会自动被截掉</span>
 <span class="c">#</span>
 <span class="c"># 设置完 访问密码，还会被询问设置 view-only password，</span>
 <span class="c"># 用来给其他人看桌面演示（鼠标、键盘无效），这个不是必须的</span>
 <span class="c"># </span>
 vncserver
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>
    <p>配置完成后，默认运行在 <code class="highlighter-rouge">5901</code> 端口，VNC <code class="highlighter-rouge">:1</code>，第二个客户端连接使用 <code class="highlighter-rouge">5902</code> <code class="highlighter-rouge">:2</code>，以此类推。</p>
  </li>
  <li>
    <p>先关闭刚启动的 vnc server，来继续后面的配置： <code class="highlighter-rouge">vncserver -kill :1</code></p>
  </li>
  <li>修改 <code class="highlighter-rouge">~/.vnc/xstartup</code><br />
 vnc server 的初始化脚本是： <code class="highlighter-rouge">~/.vnc/xstartup</code>
    <div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre> <span class="c">#先备份</span>
 mv ~/.vnc/xstartup ~/.vnc/xstartup.bak
</pre></td></tr></tbody></table>
</div>
    </div>

    <p>然后，修改：</p>

    <ul>
      <li>For xfce4 desktop environment:
        <div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>  <span class="c">#!/bin/bash</span>
  xrdb <span class="nv">$HOME</span>/.Xresources
  startxfce4 &amp;
</pre></td></tr></tbody></table>
</div>
        </div>
      </li>
      <li>第一行命令 <code class="highlighter-rouge">xrdb $HOME/.Xresources</code>, tells VNC’s GUI framework to read the server user’s .Xresources file. <code class="highlighter-rouge">.Xresources</code> is where a user can make changes to certain settings of the graphical desktop, like terminal colors, cursor themes, and font rendering.</li>
      <li>第二行命令 <code class="highlighter-rouge">startxfce4 &amp;</code> tells the server to launch Xfce. Whenever you start or restart the VNC server, these commands will execute automatically.</li>
    </ul>

    <p>最后，记得改成可执行： <code class="highlighter-rouge">chmod +x ~/.vnc/xstartup</code></p>
  </li>
  <li>启动vnc： <code class="highlighter-rouge">vncserver</code></li>
  <li>使用 vnc viewer 访问 server-ip:5901 ，输入密码就可以进入了</li>
  <li></li>
  <li></li>
</ol>

<h3 id="lxde-desktop">lxde desktop</h3>

<ul>
  <li>参考
    <ul>
      <li><a href="https://bevisy.github.io/p/install-tigervncserver-on-ubuntu-20.04/">Ubuntu 20.04 安装 Tigervncserver</a></li>
      <li><a href="https://kimconnect.com/linux-use-lubuntu-20-04-tightvnc-server-novnc-websockify-to-create-a-terminal-server-accessible-via-any-browser/">Linux: Use Lubuntu 20.04, TightVNC Server, NoVNC, WebSockify to Create a Terminal Server Accessible via Any Browser!</a></li>
      <li><a href=""></a></li>
      <li><a href=""></a></li>
      <li><a href=""></a></li>
      <li><a href=""></a></li>
      <li><a href=""></a></li>
      <li><a href=""></a></li>
    </ul>
  </li>
</ul>

<ol>
  <li>安装</li>
</ol>

<div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>sudo apt -y install tightvncserver tigervnc-common xfonts-base xorg lxde-core autocutsel

<span class="c"># Initialize VNC server for the first time to create the config file</span>
vncserver :1
vncserver -kill :1
</pre></td></tr></tbody></table>
</div>
</div>

<ol>
  <li>配置 <code class="highlighter-rouge">vim /home/$(whoami)/.vnc/xstartup</code></li>
</ol>

<div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10</pre></td><td class="code"><pre><span class="c">#!/bin/sh</span>
<span class="nb">unset </span>SESSION_MANAGER
<span class="nb">unset </span>DBUS_SESSION_BUS_ADDRESS
xrdb <span class="nv">$HOME</span>/.Xresources
xsetroot -solid grey
<span class="nb">export </span><span class="nv">XKL_XMODMAP_DISABLE</span><span class="o">=</span>1

autocutsel -fork
lxterminal &amp;
/usr/bin/lxsession -s LXDE &amp;
</pre></td></tr></tbody></table>
</div>
</div>

<div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>sudo chmod +x /home/<span class="k">$(</span>whoami<span class="k">)</span>/.vnc/xstartup
  
<span class="c"># Configure firewall to allow port 5901</span>
sudo ufw allow from any to any port 5901 proto tcp
</pre></td></tr></tbody></table>
</div>
</div>

<ol>
  <li>启动</li>
</ol>

<div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre><span class="c"># Restart session 1</span>
<span class="nv">sessionId</span><span class="o">=</span>1
vncserver -kill :<span class="nv">$sessionId</span>
rm -f /tmp/.X<span class="nv">$sessionId</span>-lock
rm -f /tmp/.X11-unix/X<span class="nv">$sessionId</span>
vncserver :<span class="nv">$sessionId</span> -geometry 1920x1080 -depth 16 -pixelformat rgb565
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="gnome-desktop">gnome desktop</h3>

<ul>
  <li>参考：
    <ul>
      <li>
        <table>
          <tbody>
            <tr>
              <td>[Install VNC Server on Ubuntu 20.04</td>
              <td>18.04 LTS to access GNOME](https://www.how2shout.com/linux/install-vnc-server-on-ubuntu-20-04-18-04-lts-to-access-gnome/)</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li><a href="https://hustakin.github.io/bestpractice/setup-vncserver-for-ubuntu/">Using VNC to Operate a Desktop on Ubuntu 18.04</a></li>
      <li><a href="https://www.alibabacloud.com/help/en/simple-application-server/latest/use-vnc-to-build-guis-on-ubuntu-18-04-and-20-04">Use VNC to build GUIs on Ubuntu 18.04 and 20.04</a></li>
      <li><a href="https://www.sproutworkshop.com/2021/04/how-to-create-a-virtual-headless-tigervnc-server-on-ubuntu-20-04/">How to Create a Virtual (Headless) TigerVNC Server on Ubuntu 20.04</a></li>
      <li><a href=""></a></li>
    </ul>
  </li>
</ul>

<p>总结： gnome 的效果差，运行速度慢，不建议使用。</p>

<ol>
  <li>安装
    <div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre> sudo apt update
 sudo apt install tigervnc-standalone-server tigervnc-xorg-extension 
 sudo apt install xserver-xorg-core
 sudo apt install ubuntu-gnome-desktop
 sudo systemctl start gdm

 <span class="c"># 设置vnc passwd</span>
 vncpasswd

 <span class="c"># 第一次运行 vnc server</span>
 vncserver
 <span class="c"># 关闭</span>
 vncserver -kill :<span class="k">*</span>
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>
    <p>配置</p>

    <p><code class="highlighter-rouge">cat ~/.vnc/xstartup</code></p>

    <div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre> <span class="c">#!/bin/sh </span>
 <span class="o">[</span> -x /etc/vnc/xstartup <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">exec</span> /etc/vnc/xstartup
 <span class="o">[</span> -r <span class="nv">$HOME</span>/.Xresources <span class="o">]</span> <span class="o">&amp;&amp;</span> xrdb <span class="nv">$HOME</span>/.Xresources
 vncconfig -iconic &amp;
 dbus-launch --exit-with-session gnome-session &amp;
</pre></td></tr></tbody></table>
</div>
    </div>

    <p><code class="highlighter-rouge">sudo chmod +x ~/.vnc/xstartup</code></p>
  </li>
  <li>
    <p>启动</p>

    <p><code class="highlighter-rouge">vncserver -localhost no -geometry 800x600 -depth 24</code><br />
 注意 <code class="highlighter-rouge">localhost no</code> 没加的话，默认就是 <code class="highlighter-rouge">localhost yes</code> ，无法被网络上其他主机访问，只能localhost访问。</p>
  </li>
</ol>

<h3 id="ufw-开启-5901-端口">ufw 开启 5901 端口</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>sudo ufw allow 5901
sudo ufw status
</pre></td></tr></tbody></table>
</div>
</div>

<h3 id="vncserver-自启动">vncserver 自启动</h3>

<ol>
  <li>
    <p>创建 <code class="highlighter-rouge">/etc/systemd/system/vncserver@.service</code></p>

    <ul>
      <li>User, Group, WorkingDirectory,PIDFILE 都要改成你自己的用户名、用户组和用户目录</li>
      <li>ExecStart 里面，如果不使用ssh tunnel ，那么，要删除掉 -localhost</li>
    </ul>

    <div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</pre></td><td class="code"><pre> [Unit]
 Description=Start TightVNC server at startup
 After=syslog.target network.target

 [Service]
 Type=forking
 User=sammy
 Group=sammy
 WorkingDirectory=/home/sammy

 PIDFile=/home/sammy/.vnc/%H:%i.pid
 ExecStartPre=-/usr/bin/vncserver -kill :%i &gt; /dev/null 2&gt;&amp;1
 ExecStart=/usr/bin/vncserver -depth 24 -geometry 1280x800 -localhost no :%i
 ExecStop=/usr/bin/vncserver -kill :%i

 [Install]
 WantedBy=multi-user.target
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>启动测试
    <div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre> sudo systemctl daemon-reload
 sudo systemctl start vncserver@1.service
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>开机自启动
    <div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre> sudo systemctl <span class="nb">enable </span>vncserver@1.service
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li></li>
  <li></li>
  <li></li>
</ol>

<h3 id="支持剪贴板">支持剪贴板</h3>

<ul>
  <li>参考
    <ul>
      <li><a href="https://askubuntu.com/a/754420">autocutsel worked for me</a></li>
      <li><a href="https://unix.stackexchange.com/questions/35030/how-can-i-copy-paste-data-to-and-from-the-windows-clipboard-to-an-opensuse-clipb">How can I copy/paste data to and from the Windows clipboard to an OpenSuse clipboard using VNC?</a></li>
      <li><a href=""></a></li>
    </ul>
  </li>
</ul>

<h4 id="使用-autocutsel">使用 autocutsel</h4>

<ol>
  <li>安装
    <div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre> sudo apt-get install autocutsel
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>
    <p>编辑 <code class="highlighter-rouge">~/.vnc/xstartup</code></p>

    <p>在session命令前面添加： <code class="highlighter-rouge">autocutsel -fork</code></p>

    <p>比如：</p>

    <ul>
      <li>for LXTE
        <div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>  ... ...

  autocutsel -fork
  lxterminal &amp;
  /usr/bin/lxsession -s LXDE &amp;
</pre></td></tr></tbody></table>
</div>
        </div>
      </li>
      <li>
        <p>for Xfce4</p>

        <div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>  ... ...
  autocutsel -fork  
  startxfce4 &amp; 
</pre></td></tr></tbody></table>
</div>
        </div>
      </li>
    </ul>
  </li>
  <li>重启 vncserver</li>
  <li>在client 主机，例如，manjaro kde，Ctrl + Shift + c 拷贝</li>
  <li>到 vnc viewer 中 Ctrl + Shift + v 粘帖</li>
</ol>

<p><strong>注意</strong> 目前存在拷贝中文，变成乱码的问题。 暂时可以创建个包含中文的文件，然后vnc viewer里面打开。</p>

<h3 id="中文支持">中文支持</h3>

<ul>
  <li>参考
    <ul>
      <li><a href="https://www.cxyzjd.com/article/weixin_34289454/93689592">Ubuntu配置图形桌面LXDE和VNC、中文语言包、中文输入法</a></li>
      <li><a href="https://www.lijiejie.com/ubuntu-vps-config-lxde-vnc/">Ubuntu VPS配置轻量级图形桌面LXDE和VNC</a></li>
      <li><a href="https://www.laozuo.org/2932.html#%E7%AC%AC%E4%B8%83%E3%80%81%E5%AE%89%E8%A3%85Firefox%E5%8F%8A%E6%94%AF%E6%8C%81%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87">Linux VPS Debian安装LXDE+VNC桌面 附配Firefox浏览器及简体中文</a></li>
      <li><a href="http://wp.jinxiart.com/post/52.html">Debian或Ubantu系统安装LXDE+VNC桌面环境教程</a></li>
      <li><a href="https://www.lijiejie.com/ubuntu-vps-config-lxde-vnc/">Ubuntu VPS配置轻量级图形桌面LXDE和VNC</a></li>
      <li><a href=""></a></li>
      <li><a href=""></a></li>
    </ul>
  </li>
</ul>

<h3 id="ssh-tunnel-访问增加安全性">ssh tunnel 访问，增加安全性</h3>

<ol>
  <li>
    <p>重启 vncserver： <code class="highlighter-rouge">vncserver -localhost</code><br />
 <code class="highlighter-rouge">-localhost</code> 表示只能本地连接上服务器</p>
  </li>
  <li>
    <p>在客户端电脑上创建一个ssh tunnel</p>
    <div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>ssh -L 59000:localhost:5901 -C -N -l your-user-name your_server_ip
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
</ol>

<p>vnc 本身不支持安全连接，所以在本地做了一个ssh tunnel</p>

<ul>
  <li><code class="highlighter-rouge">-L 59000:localhost:5901</code> 通过<code class="highlighter-rouge">localhost:59000</code> 通过ssh tunnel 转发到服务器的 <code class="highlighter-rouge">localhost:5901</code></li>
  <li><code class="highlighter-rouge">-C</code> 开启压缩，节约流量</li>
  <li><code class="highlighter-rouge">-N</code> 不需要通过ssh执行命令，只是转发流量</li>
  <li><code class="highlighter-rouge">-l your-user-name your_server_ip</code> 登录服务器时候的用户和地址</li>
</ul>

<ol>
  <li>VNC 客户端输入 <code class="highlighter-rouge">localhost:59000</code> 进行连接。</li>
  <li></li>
  <li></li>
</ol>

<h2 id="google-chrome-stable-启动整个窗口都是粉色">google-chrome-stable 启动，整个窗口都是粉色</h2>

<div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3</pre></td><td class="code"><pre>ERROR:sandbox_linux.cc InitializeSandbox() called with multiple threads in progress gpu-process
ERROR:gpu_memory_buffer_support_x11.cc(44) dri3 extension not supported.
Unsupported visual with rgb mask 0x7, 0x38, 0xc0. Please report this to https://crbug.com/1025266
</pre></td></tr></tbody></table>
</div>
</div>

<h2 id="在manjaro上使用realvnc-viewer-访问-esxi-上的ubuntu-1804">在Manjaro上使用realvnc viewer 访问 Esxi 上的Ubuntu 18.04</h2>

<ul>
  <li>
    <p>Ubuntu 18.04 上安装VNC Server : vino</p>

    <div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre>  sudo apt install vino
  # 关闭加密
  gsettings set org.gnome.Vino require-encryption false
  # 重启系统
  reboot
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>
    <p>Manjaro 安装 realvnc viewer</p>

    <ol>
      <li>安装 Realvnc Viewer
        <div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>  yay -S realvnc-vnc-viewer
</pre></td></tr></tbody></table>
</div>
        </div>
      </li>
      <li>启动 VNC Viewer -&gt; File 菜单 -&gt; New Connection…
        <ol>
          <li>VNC Server: 目标ubuntu的IP</li>
          <li>Security / Encryption : Let VNC Server choose</li>
          <li>保存</li>
        </ol>
      </li>
      <li>连接目标Ubuntu</li>
    </ol>
  </li>
  <li>
    <p>存在的问题</p>

    <ol>
      <li>可以剪贴板双向粘帖，但是中文乱码。</li>
      <li></li>
      <li></li>
    </ol>
  </li>
</ul>

<h2 id="debian-上安装vnc-server">Debian 上安装VNC Server</h2>

<ul>
  <li>参考
    <ul>
      <li><a href="https://atetux.com/how-to-install-tigervnc-on-debian-11">How To Install TigerVNC on Debian 11</a></li>
      <li><a href="https://www.howtoforge.com/how-to-install-vnc-server-on-debian-11/">How to Install VNC Server on Debian 11</a></li>
      <li><a href="https://itnixpro.com/install-and-configure-vnc-server-on-debian-11/">Install and Configure VNC server on Debian 11</a></li>
      <li><a href="https://linuxize.com/post/how-to-install-and-configure-vnc-on-debian-9/">How to Install and Configure VNC on Debian 9</a></li>
      <li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-vnc-on-debian-10">How to Install and Configure VNC on Debian 10</a><br />
  digitalocean的文档就是很清晰。</li>
      <li><a href="https://www.server-world.info/en/note?os=Debian_11&amp;p=desktop&amp;f=6">Desktop Environment : Configure VNC Server</a></li>
      <li><a href="https://idroot.us/install-vnc-server-debian-11/">How To Install VNC Server on Debian 11</a></li>
      <li><a href="https://computingforgeeks.com/install-and-configure-tigervnc-vnc-server-on-debian/">Install and Configure TigerVNC VNC Server on Debian 11/10</a></li>
      <li><a href=""></a></li>
      <li><a href=""></a></li>
      <li><a href=""></a></li>
      <li><a href=""></a></li>
    </ul>
  </li>
</ul>

<ol>
  <li>安装
    <div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12</pre></td><td class="code"><pre> <span class="c"># Install XFCE 4</span>
 sudo apt install xfce4 xfce4-goodies dbus-x11 -y

 <span class="c"># Install TigerVNC Server</span>
 sudo apt install tigervnc-standalone-server -y

 <span class="c"># VNC 配置密码</span>
 vncpasswd

 <span class="c"># 首次启动、关闭，以生成 xstartup 配置文件</span>
 vncserver
 vncserver -kill :1
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>
    <p>配置 ~/.vnc/xstartup</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre> <span class="c">#!/bin/sh</span>
 <span class="nb">unset </span>SESSION_MANAGER
 <span class="nb">unset </span>DBUS_SESSION_BUS_ADDRESS
 <span class="nb">exec</span> /bin/sh /etc/xdg/xfce4/xinitrc
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>
    <p>启动 vncserver</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre> <span class="c"># 命令行启动</span>
 vncserver -localhost no

 <span class="c"># 检查开启的端口是否有 vnc 5901</span>
 ss -tunlp | grep vnc
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>
    <p>vnc 客户端访问 ip:5901 来连接</p>

    <div class="highlighter-rouge"><div class="highlight"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre> # tigervnc viewer
 sudo apt install tigervnc-viewer -y
</pre></td></tr></tbody></table>
</div>
    </div>
  </li>
  <li>配置VNC service</li>
</ol>

<ul>
  <li><code class="highlighter-rouge">/etc/systemd/system/vncserver@.service</code><br />
~~~<br />
[Unit]<br />
Description=Start TightVNC server at startup<br />
After=syslog.target network.target</li>
</ul>

<p>[Service]<br />
Type=forking<br />
User=your-name<br />
Group=your-name<br />
WorkingDirectory=/home/your-name</p>

<p>PIDFile=/home/your-name/.vnc/%H:%i.pid<br />
ExecStartPre=-/usr/bin/vncserver -kill :%i &gt; /dev/null 2&gt;&amp;1<br />
ExecStart=/usr/bin/vncserver -depth 24 -geometry 1440x960 :%i -localhost no<br />
ExecStop=/usr/bin/vncserver -kill :%i</p>

<p>[Install]<br />
WantedBy=multi-user.target<br />
~~~</p>

<p>启动 5901 端口上桌面： <code class="highlighter-rouge">sudo systemctl start vncserver@1.service</code></p>


      <footer class="entry-meta">
        <span class="entry-tags"></span>
        
        
      </footer>
    </div><!-- /.entry-content -->
    
    
    
  </article>
</div><!-- /#main -->
</div><!-- post container -->














<script type="text/javascript">
  // embeded-iframe
  $(window).load(function(){
    $('.embeded-iframe').each(function(){
      $(this).height($(this).contents().find('html').height());
    });
  });
</script>





<div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2023 wi. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://github.com/aron-bordin/neo-hpstr-jekyll-theme" rel="nofollow">Neo-HPSTR Theme</a>.</span>

<script src="/assets/js/main.js?20230725301728281823445"></script>

  </footer>
</div><!-- /.footer-wrapper -->

</body>
</html>
